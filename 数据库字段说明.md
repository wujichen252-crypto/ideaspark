# PerformanceApplication 模型字段详细说明

## 1. 模型概览
`PerformanceApplication` 是表演报名系统的核心模型，用于记录乐团的报名信息，管理整个报名流程和审核状态。

## 2. 状态常量定义

| 常量名 | 值 | 说明 | 用途 |
|--------|-----|------|------|
| `STATUS_PENDING` | "pending" | 待审核 | 报名信息刚提交，等待审核人员处理 |
| `STATUS_APPROVED` | "approved" | 已通过 | 报名信息审核通过，乐团可以参加表演 |
| `STATUS_REJECTED` | "rejected" | 已驳回 | 报名信息不符合要求，审核未通过 |

## 3. 乐团类型常量

| 常量名 | 值 | 说明 | 用途 |
|--------|-----|------|------|
| `TYPE_WIND_BAND` | "wind_band" | 管乐团 | 管弦乐团类型标识 |
| `TYPE_BRASS_BAND` | "brass_band" | 铜管乐团 | 铜管乐器为主的乐团类型标识 |
| `TYPE_PERCUSSION_BAND` | "percussion_band" | 打击乐团 | 以打击乐器为主的乐团类型标识 |
| `TYPE_OTHER` | "other" | 其他 | 不属于以上类型的乐团 |

## 4. 参演组别常量

| 常量名 | 值 | 说明 | 用途 |
|--------|-----|------|------|
| `GROUP_PRIMARY` | "primary" | 小学组 | 小学生参赛组别 |
| `GROUP_MIDDLE` | "middle" | 中学组 | 中学生参赛组别 |

## 5. 字段详细说明

### 5.1 主键字段
- **id**: `BigAutoField`
  - 数据类型：大整数自增字段
  - 约束：主键（primary_key=True）
  - 说明：报名记录的唯一标识符，系统自动生成
  - 用途：在数据库中唯一标识每一条报名记录

### 5.2 核心基本信息字段

- **application_no**: `CharField`
  - 数据类型：字符串，最大长度20
  - 约束：唯一值（unique=True）
  - 说明：系统自动生成的唯一报名编号
  - 格式：`SIGN-YYYYMMDD-XXXXX`（SIGN-年月日-5位序号）
  - 用途：作为报名的业务唯一标识符，方便查询和管理

- **orchestra_name**: `CharField`
  - 数据类型：字符串，最大长度100
  - 约束：必填，字符长度2-100
  - 验证器：MinLengthValidator(2), MaxLengthValidator(100)
  - 说明：参赛乐团的正式名称
  - 用途：标识参赛乐团的名称

- **orchestra_type**: `CharField`
  - 数据类型：字符串，最大长度20
  - 约束：可选值（choices=TYPE_CHOICES），默认值为"other"
  - 说明：乐团的类型分类
  - 可选值：管乐团/铜管乐团/打击乐团/其他
  - 用途：根据乐团类型设置不同的审核标准和人数限制

- **selected_music**: `CharField`
  - 数据类型：字符串，最大长度200
  - 约束：必填
  - 说明：参赛自选曲目名称
  - 用途：记录乐团将要表演的曲目

- **performance_group**: `CharField`
  - 数据类型：字符串，最大长度20
  - 约束：可选值（choices=GROUP_CHOICES），必填
  - 说明：参赛组别
  - 可选值：小学组/中学组
  - 用途：根据参赛组别进行分组评选

### 5.3 作品时长字段

- **duration_minutes**: `PositiveSmallIntegerField`
  - 数据类型：无符号小整数
  - 约束：默认值为0，范围0-65535
  - 说明：作品时长的分钟部分
  - 用途：记录表演曲目所需的时间（分钟）

- **duration_seconds**: `PositiveSmallIntegerField`
  - 数据类型：无符号小整数
  - 约束：默认值为0，范围0-65535（实际业务应限制在0-59）
  - 说明：作品时长的秒钟部分
  - 用途：记录表演曲目所需的时间（秒）

### 5.4 学校信息字段

- **school_name**: `CharField`
  - 数据类型：字符串，最大长度100
  - 约束：必填
  - 说明：参赛乐团所属学校的名称
  - 用途：记录乐团的归属学校

### 5.5 领队信息字段

- **leader_name**: `CharField`
  - 数据类型：字符串，最大长度50
  - 约束：必填
  - 说明：乐团领队的姓名
  - 用途：记录负责此次参赛的主要联系人

- **leader_phone**: `CharField`
  - 数据类型：字符串，最大长度20
  - 约束：必填
  - 说明：领队的联系电话
  - 用途：用于重要通知和紧急联系

- **contact_address**: `TextField`
  - 数据类型：文本字段，最大长度200
  - 约束：必填
  - 说明：乐团的联系地址信息
  - 用途：用于邮寄相关材料或文件

### 5.6 乐团简介字段

- **orchestra_introduction**: `TextField`
  - 数据类型：文本字段，最大长度300
  - 约束：必填，最大长度300
  - 验证器：MaxLengthValidator(300)
  - 说明：乐团简介信息，详细介绍乐团历史、特点等
  - 用途：帮助审核人员了解乐团背景

### 5.7 关联字段

- **applicant**: `ForeignKey`
  - 数据类型：外键，关联到'user.User'模型
  - 约束：级联删除（on_delete=models.CASCADE）
  - 关联名称：related_name="performance_applications"
  - 说明：提交报名信息的用户账号
  - 用途：记录报名信息的创建者，便于权限管理

### 5.8 状态字段

- **status**: `CharField`
  - 数据类型：字符串，最大长度20
  - 约束：可选值（choices=STATUS_CHOICES），默认值为"pending"
  - 说明：报名信息的审核状态
  - 可选值：待审核/已通过/已驳回
  - 用途：控制报名流程，标识当前报名的处理状态

- **review_notes**: `TextField`
  - 数据类型：文本字段，最大长度500
  - 约束：可选（blank=True）
  - 说明：审核人员的意见和说明
  - 用途：特别是在审核驳回时，说明驳回原因

### 5.9 时间字段

- **create_time**: `DateTimeField`
  - 数据类型：日期时间字段
  - 约束：自动添加（auto_now_add=True）
  - 说明：报名信息创建时间
  - 用途：记录报名提交时间，用于排序和统计

- **update_time**: `DateTimeField`
  - 数据类型：日期时间字段
  - 约束：自动更新（auto_now=True）
  - 说明：报名信息最后更新时间
  - 用途：记录数据最后修改时间

- **review_time**: `DateTimeField`
  - 数据类型：日期时间字段
  - 约束：可选（null=True, blank=True）
  - 说明：审核完成的时间
  - 用途：记录审核通过或驳回的具体时间

- **performance_date**: `DateField`
  - 数据类型：日期字段
  - 约束：可选（null=True, blank=True）
  - 说明：分配给该乐团的表演日期
  - 用途：在报名审核通过后，为乐团安排具体的表演时间

## 6. 模型方法

- **save()**: 重写的保存方法，自动生成报名编号
  - 逻辑：如果没有指定application_no，则按格式自动生成
  - 格式：SIGN-年月日-5位序号
  - 实现：查询当天最后一条记录，序号加1

- **validate_member_requirements()**: 验证成员数量是否符合最小要求
  - 管乐团：正式队员不少于35人
  - 铜管乐团：正式队员不少于20人
  - 打击乐团：无最小人数限制

## 7. Meta信息

- **db_table**: "performance_applications" - 数据库表名
- **verbose_name**: "表演报名表" - 单数显示名称
- **verbose_name_plural**: "表演报名表" - 复数显示名称（中文无需复数）
- **ordering**: ['-create_time'] - 默认按创建时间降序排序
- **indexes**: 定义了多个索引以优化查询性能
  - application_no字段索引
  - status字段索引
  - orchestra_type字段索引
  - applicant字段索引

---

# Instructor 模型字段详细说明

## 1. 模型概览
`Instructor` 模型用于记录每个表演报名的指导老师详细信息，与报名表为一对多关系。

## 2. 性别常量定义

| 常量名 | 值 | 说明 | 用途 |
|--------|-----|------|------|
| `GENDER_MALE` | "male" | 男 | 男性性别标识 |
| `GENDER_FEMALE` | "female" | 女 | 女性性别标识 |
| `GENDER_OTHER` | "other" | 其他 | 其他性别标识 |

## 3. 字段详细说明

- **id**: `BigAutoField` - 指导老师记录的唯一标识符
- **name**: `CharField` - 指导老师的姓名，最大长度50，必填
- **id_card**: `CharField` - 18位身份证号码，用于身份验证，最大长度18，唯一
- **gender**: `CharField` - 指导老师的性别，选项：男/女/其他，最大长度10
- **age**: `PositiveSmallIntegerField` - 指导老师的年龄，无符号小整数
- **school_name**: `CharField` - 指导老师所属学校的名称，最大长度100
- **phone**: `CharField` - 指导老师的联系电话，最大长度20
- **performance_application**: `ForeignKey` - 关联的表演报名记录，级联删除
- **create_time**: `DateTimeField` - 指导老师信息创建时间，自动生成

---

# Performer 模型字段详细说明

## 1. 模型概览
`Performer` 模型用于记录每个表演报名的参演人员详细信息，与报名表为一对多关系，包含角色分类。

## 2. 性别常量定义

| 常量名 | 值 | 说明 | 用途 |
|--------|-----|------|------|
| `GENDER_MALE` | "male" | 男 | 男性性别标识 |
| `GENDER_FEMALE` | "female" | 女 | 女性性别标识 |
| `GENDER_OTHER` | "other" | 其他 | 其他性别标识 |

## 3. 角色常量

| 常量名 | 值 | 说明 | 用途 |
|--------|-----|------|------|
| `ROLE_REGULAR` | "regular" | 正式队员 | 正式参演的队员 |
| `ROLE_RESERVE` | "reserve" | 预备队员 | 替补队员，不正式参演 |

## 4. 字段详细说明

- **id**: `BigAutoField` - 参演人员记录的唯一标识符
- **name**: `CharField` - 参演人员的姓名，最大长度50，必填
- **id_card**: `CharField` - 18位身份证号码，用于身份验证，最大长度18，唯一
- **gender**: `CharField` - 参演人员的性别，选项：男/女/其他，最大长度10
- **age**: `PositiveSmallIntegerField` - 参演人员的年龄，无符号小整数
- **school_name**: `CharField` - 参演人员所在学校的名称，最大长度100
- **role**: `CharField` - 参演人员角色，选项：正式队员/预备队员，默认正式队员
- **performance_application**: `ForeignKey` - 关联的表演报名记录，级联删除
- **create_time**: `DateTimeField` - 参演人员信息创建时间，自动生成

## 5. 模型方法

- **save()**: 保存时验证成员数量限制，调用_validate_member_limits()方法
- **_validate_member_limits()**: 根据乐团类型验证成员数量限制：
  - 管乐团：正式队员≤65人，预备队员≤5人
  - 铜管乐团：正式队员≤45人，预备队员≤3人
  - 打击乐团：正式队员≤8人，预备队员≤3人

---

# PhotoAttachment 模型字段详细说明

## 1. 模型概览
`PhotoAttachment` 模型用于存储表演相关的照片URL，每个报名只能上传一张照片，与报名表为一对一关系。

## 2. 字段详细说明

- **id**: `BigAutoField` - 照片附件记录的唯一标识符
- **performance_application**: `OneToOneField` - 关联的表演报名记录，一对一关系，级联删除
- **photo_url**: `URLField` - 照片在OSS上的访问链接，支持JPEG或TIFF格式，分辨率600dpi，最大长度500
- **create_time**: `DateTimeField` - 照片上传时间，自动生成

---

# VideoAttachment 模型字段详细说明

## 1. 模型概览
`VideoAttachment` 模型用于存储表演视频的OSS URL信息，与报名表为一对一关系。

## 2. 字段详细说明

- **id**: `BigAutoField` - 视频附件记录的唯一标识符
- **performance_application**: `OneToOneField` - 关联的表演报名记录，一对一关系，级联删除
- **video_url**: `URLField` - 表演视频在OSS上的访问链接，最大长度500
- **create_time**: `DateTimeField` - 视频上传时间，自动生成

---

# ApplicationFormScan 模型字段详细说明

## 1. 模型概览
`ApplicationFormScan` 模型用于存储主办方盖章后的报名信息表扫描件OSS链接，与用户为多对一关系。

## 2. 字段详细说明

- **id**: `BigAutoField` - 扫描件记录的唯一标识符
- **uploader**: `ForeignKey` - 上传扫描件的用户账号，关联到'user.User'模型，级联删除
- **scan_url**: `URLField` - 盖章后的报名信息表扫描件在OSS上的访问链接，最大长度500
- **create_time**: `DateTimeField` - 扫描件上传时间，自动生成

## 3. 模型方法

- **get_user_scans(cls, user)**: 类方法，获取用户上传的所有扫描件
  - 参数：user - 用户对象
  - 返回：QuerySet - 用户的扫描件查询集，按创建时间降序排序